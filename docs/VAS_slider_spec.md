# iPad用 VAS スライダー設計・測定仕様

***

# iPad用 VAS スライダー設計仕様書

- 関連文書:  
  - [測定フロー仕様](#測定フロー仕様)  
  - [UI仕様](#ui仕様)  
  - [実装詳細](#実装詳細)  

## 1. 概要・目的

本仕様書は、iPad 11/13 上で視覚的アナログスケール（VAS）を 0–100 mm 実長に近い形で再現し、バイアスの少ない主観的疼痛評価を行うための設計仕様を示す。  
測定結果は研究用途（例: 疼痛評価研究、介入効果の検証など）での利用を想定し、再現性と透明性を重視する。

***

## 2. 測定フロー仕様

詳細: [UI仕様](#ui仕様), [実装詳細](#実装詳細)

1. **初期状態**  
   - アプリ起動時、VAS 三角形バーとガイドが中央付近（50 付近）に配置された状態で表示される。  
   - 数値・目盛り・顔文字等のヒントは表示しない。

2. **調整フェーズ（adjusting）**  
   - 対象者はガイドを左右にドラッグして、自身の痛みの強さに相当する位置に合わせる。  
   - この段階では数値などのフィードバックは一切表示しない。

3. **候補確定フェーズ（candidateShown）**  
   - 対象者が「終了」ボタンをタップすると、現在のガイド位置が一時的な回答候補として確定される。  
   - 画面に VAS 値（0–100）が一度だけ表示され、対象者が確認できる。

4. **最終確定・記録**  
   - 対象者が再タップ（または「確定」ボタン）すると、VAS 値を測定結果として記録する。  
   - 記録後、ガイド位置は中央（50 付近）に自動リセットされ、状態は再び調整フェーズへ戻る。

5. **再測定**  
   - 原則として、対象者の自己判断によるやり直しは不可とする。  
   - 研究上必要な場合のみ、検者が検者用 UI（画面端のボタン等）を操作して再測定を開始する。

***

## 3. UI仕様

詳細: [測定フロー仕様](#測定フロー仕様), [実装詳細](#実装詳細)

### 3.1 画面構成

- 上部:  
  - タイトル（例: 「現在の痛みの強さ」）  
  - 必要最小限の説明文（被験者向け案内）

- 中央:  
  - VAS 三角形バー（斜面）  
  - その上に重ねるスライド可能なガイド

- 下部:  
  - 「終了」ボタン（対象者用）  
  - 検者用ボタン（再測定・デバッグ用など。対象者からはできるだけ意識されない位置）

### 3.2 三角形バー（斜面）

- 紙製 VAS スケールの三角定規を模した形状とし、底辺が 0–100 mm に対応する。  
- 左端を 0、右端を 100 とみなし、右へ行くほど痛みが強い方向性を表現する。  
- バーは単色もしくは緩やかなグラデーションのみとし、目盛線や区切り線は表示しない（バイアス低減のため）。

### 3.3 ガイド

- 三角形バー上に重ねる細長い矩形またはバー形状とし、「ここを動かす」ことが分かる最小限の視覚的強調（色・矢印など）のみを付与する。  
- ガイドは水平方向へのドラッグ操作でのみ移動し、バー領域の外には出ないよう制限する。

### 3.4 情報表示

- 調整フェーズでは、VAS 値・目盛り・顔文字などの追加情報を一切表示しない。  
- 候補確定後のみ、画面中央付近に VAS 値（整数 0–100）を一度だけ表示する。  
- 検者向けに、デバッグやログ確認のための情報を別途小さく表示してもよいが、対象者の注意を引かない位置とデザインとする。

***

## 4. 実装詳細

詳細: [測定フロー仕様](#測定フロー仕様), [UI仕様](#ui仕様)

### 4.1 物理長さの扱い

- `PhysicalMetricsConverter` などを用いて、iPad 11/13 上で **100 mm に相当するポイント長** を算出し、これを `vasWidth` として使用する。[7]
- 三角形バーの `frame(width: vasWidth, height: vasHeight)` を設定し、デバイス差を吸収する。

### 4.2 三角形バーの描画

- SwiftUI の `Shape` を用いて `TriangularVASBar` を定義する。  
- `path(in rect: CGRect)` 内で、  
  - 左下: \((rect.minX, rect.maxY)\)  
  - 右下: \((rect.maxX, rect.maxY)\)  
  - 上側の任意点（例: \((rect.minX, rect.minY)\)）  
  の 3 点を結んだ三角形を描画する。

### 4.3 ガイドとカスタムスライダー

- ガイド位置は `@State var value: Double`（範囲 0–100）として保持する。  
- 三角形バーを背景とし、その上に `ZStack` でガイドを重ね、`DragGesture` または `Gesture` 合成により、  
  - ドラッグ位置（x 座標） ↔ `value`（0–100）の変換を行う。[12]
- 実装クラス（例）  
  - `struct VASSliderView: View`  
    - プロパティ: `@Binding var value: Double`  
    - プロパティ: `let vasWidth: CGFloat`  
    - 内容: `TriangularVASBar`＋ガイド＋ドラッグ処理

### 4.4 測定フェーズ管理

- 測定状態を以下のような列挙型で管理する。  
  - `enum MeasurePhase { case adjusting, candidateShown }`  
- `@State var phase: MeasurePhase = .adjusting` とし、  
  - `adjusting`: ガイドのみ表示（数値非表示）  
  - `candidateShown`: 「終了」タップ後、VAS 値を表示  
  とする。  
- 「終了」ボタンタップで `phase = .candidateShown`、再タップで値を記録し `phase = .adjusting` に戻す。

### 4.5 記録とリセット

- 確定時に、VAS 値・日時・被験者 ID・試行番号などを含むレコードを保存する（形式は CSV または JSON を想定）。[2]
- 記録後、`value` を 50 付近にリセットし、ガイドを中央に戻す。

***

## 5. 変更履歴

- 2025-12-12: 初版作成。測定フロー・UI仕様・実装詳細を章立てして整理。  

***

この形でいったん `VAS-spec.md` を保存しておき、将来「測定プロトコル用」「実装詳細用」などに分けたくなったら、各章を別ファイルに切り出し、上部のリンクを `./VAS-measurement-protocol.md` などに差し替えると運用しやすくなります。
